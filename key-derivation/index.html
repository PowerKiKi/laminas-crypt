<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Strong cryptography tools and password hashing.">  
    <link rel="canonical" href="https://docs.laminas.dev/laminas-crypt/key-derivation/">
    <link rel="shortcut icon" href="https://docs.laminas.dev/img/trademark-laminas-foundation-rgb.svg">

    <title>Key Derivation - laminas-crypt - Laminas Docs</title>

    <link rel="stylesheet" href="https://docs.laminas.dev/css/styles.css">
</head>
<body id="page-top" class="components">

    
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        
        <a class="logo-link navbar-brand offset-md-2" href="https://getlaminas.org/" data-tooltip data-placement="bottom" title="Go to the Laminas homepage">
            <img src="https://docs.laminas.dev/img/laminas-foundation-white.svg" height="28" alt="Laminas">
        </a>
        <a class="navbar-title" href="https://docs.laminas.dev/" data-tooltip data-placement="bottom" title="Go to the Laminas Documentation">
            Documentation
        </a>

        
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <div class="dropdown">
                        <a class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false">
                            All Docs
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a class="dropdown-item" href="https://docs.laminas.dev/components">Components</a>
                            <a class="dropdown-item" href="https://docs.mezzio.dev/">Mezzio</a>
                            <a class="dropdown-item" href="https://api-tools.getlaminas.org/">API Tools</a>
                            <a class="dropdown-item" href="https://docs.laminas.dev/mvc">MVC</a>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="https://getlaminas.org/participate" class="nav-link">Community</a>
                </li>
            </ul>

            
            
                <div class="d-block d-sm-none">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="..">laminas-crypt</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../intro/" class="subnavigation__link">Introduction</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Reference</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../block-cipher/" class="subnavigation__link">Block Ciphers</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../files/" class="subnavigation__link">Encrypting Files</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../hybrid/" class="subnavigation__link">Hybrid Cryptosystem</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Key Derivation</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../password/" class="subnavigation__link">Password</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../public-key/" class="subnavigation__link">Public Key Cryptography</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="d-block d-sm-none">
                <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</nav>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-6 offset-md-2">
                <h1 class="header__title">
                    Components

                    
                        <small class="header__subtitle">laminas-crypt</small>
                    
                </h1>
            </div>

            
            <div class="col-4 text-sm-right">
                
                    

                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/laminas/laminas-crypt/" class="header__link header__link--github" title="Go to repository of laminas-crypt">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-2 col-sm-12">
                
                
                    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#pbkdf2-adapter" class="toc__link">Pbkdf2 Adapter</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#salteds2k-adapter" class="toc__link">SaltedS2k Adapter</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#scrypt-adapter" class="toc__link">Scrypt Adapter</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#footnotes" class="toc__link">Footnotes</a>
                    </li>
                
            </ul>
        </div>
    

                
            </div>
            <div class="col-md-7 col-sm-12 content" role="main" data-spy="scroll" data-target=".toc">
                
                    <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/">Overview</a></li>
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/components/">Components</a></li>

            
                <li class="breadcrumb-item"><a href="..">laminas-crypt</a></li>

                
                    
                        
                        
                            <li class="breadcrumb-item">Reference</li>
                        
                    
                

                <li class="breadcrumb-item active" aria-current="page">Key Derivation</li>
            
        
    </ol>
</nav>






    
    
        <h2 class="chapter__headline">Reference</h2>
    

    <h1 id="key-derivation">Key Derivation</h1>
<p>In cryptography, a key derivation function (or KDF) derives one or more secret
keys from a secret value such as a master key, or known information &mdash; such
as a password or passphrase &mdash; using a pseudo-random function. For
instance, a KDF function can be used to generate encryption or authentication
keys from a user password. <code>Laminas\Crypt\Key\Derivation</code> implements a key
derivation function using specific adapters.</p>
<p>User passwords are not really suitable to be used as keys in cryptographic
algorithms, since users normally choose keys they can write with a keyboard. These
passwords use only 6 to 7 bits per character (or less). It is highly recommended
always to use a KDF function to transform a user's password in a cryptographic
key.</p>
<p>The output of the following key derivation functions is a binary string. If you
need to store the value in a database or a different persistent storage, we
suggest converting it to Base64 format, using the
<a href="http://php.net/manual/en/function.base64-encode.php">base64_encode()</a> function,
or to hex format, using the
<a href="http://php.net/manual/en/function.bin2hex.php">bin2hex()</a> function.</p>
<h2 id="pbkdf2-adapter">Pbkdf2 Adapter</h2>
<p><a href="http://en.wikipedia.org/wiki/PBKDF2">Pbkdf2</a> is a KDF that applies a
pseudorandom function, such as a cryptographic hash, to the input password or
passphrase along with a salt value and repeats the process many times to produce
a derived key, which can then be used as a cryptographic key in subsequent
operations. The added computational work makes password cracking much more
difficult, and is known as <a href="http://en.wikipedia.org/wiki/Key_stretching">key
stretching</a>.</p>
<p>In the example below we demonstrate typical usage of the <code>Pbkdf2</code> adapter.</p>
<pre class=codehilite><code class=language-php>use Laminas\Crypt\Key\Derivation\Pbkdf2;
use Laminas\Math\Rand;

$pass = 'password';
$salt = Rand::getBytes(32, true);
$key  = Pbkdf2::calc('sha256', $pass, $salt, 10000, 32);

printf (&quot;Original password: %s\n&quot;, $pass);
printf (&quot;Derived key (hex): %s\n&quot;, bin2hex($key));</code></pre>
<p>The <code>Pbkdf2</code> adapter takes the password (<code>$pass</code>) and generates a binary key of
32 bytes. The syntax is <code>calc($hash, $pass, $salt, $iterations, $length)</code> where
<code>$hash</code> is the name of the hash function to use, <code>$pass</code> is the password,
<code>$salt</code> is a pseudo random value, <code>$iterations</code> is the number of iterations of
the algorithm, and <code>$length</code> is the size of the key to be generated. We use the
<code>Rand::getBytes()</code> function from the class <code>Laminas\Math\Rand</code> to generate a random
string of 32 bytes for the salt, using a strong generator (the <code>true</code> value
means the usage of a cryptographically strong generator).</p>
<p>The number of iterations is a very important parameter for the security of the
algorithm; bigger values guarantee more security. There is no fixed value for
the parameter because the number of iterations depends on CPU power. You should
always choose a number of iterations that prevents brute force attacks.</p>
<h2 id="salteds2k-adapter">SaltedS2k Adapter</h2>
<p>The <a href="http://www.faqs.org/rfcs/rfc2440.html">SaltedS2k</a> algorithm uses a hash
function and a salt to generate a key based on a user's password. This algorithm
doesn't use a parameter to specify the number of iterations, and for that reason
it's considered less secure compared to Pbkdf2. We suggest using the SaltedS2k
algorithm only if you really need it (for instance, due to hardware
limitations).</p>
<p>The following demonstrates usage of the <code>SaltedS2k</code> adapter to generate a 32
byte key.</p>
<pre class=codehilite><code class=language-php>use Laminas\Crypt\Key\Derivation\SaltedS2k;
use Laminas\Math\Rand;

$pass = 'password';
$salt = Rand::getBytes(32, true);
$key  = SaltedS2k::calc('sha256', $pass, $salt, 32);

printf (&quot;Original password: %s\n&quot;, $pass);
printf (&quot;Derived key (hex): %s\n&quot;, bin2hex($key));</code></pre>
<h2 id="scrypt-adapter">Scrypt Adapter</h2>
<p>The <a href="http://www.tarsnap.com/scrypt.html">scrypt</a> algorithm uses the <a href="http://cr.yp.to/salsa20.html">Salsa20/8
core</a> algorithm and Pbkdf2-SHA256 to generate a
key based on a user's password. This algorithm has been designed to be more
secure against hardware brute-force attacks than alternative functions such as
<a href="http://en.wikipedia.org/wiki/PBKDF2">Pbkdf2</a> or
<a href="http://en.wikipedia.org/wiki/Bcrypt">bcrypt</a>.</p>
<p>The scrypt algorithm is based on the idea of memory-hard algorithms and
sequential memory-hard functions. A memory-hard algorithm is an algorithm which
asymptotically uses almost as many memory locations as it uses
operations<sup><a href="#footnotes">1</a></sup>. A natural way to reduce the advantage
provided by an attackerâ€™s ability to construct highly parallel circuits is to
increase the size of a single key derivation circuit â€” if a circuit is twice as
large, only half as many copies can be placed on a given area of silicon â€” while
still operating within the resources available to software implementations,
including a powerful CPU and large amounts of RAM.</p>
<blockquote>
<p>"From a test executed on modern (2009) hardware, if 5 seconds are spent
computing a derived key, the cost of a hardware brute-force attack against
scrypt is roughly 4000 times greater than the cost of a similar attack against
bcrypt (to find the same password), and 20000 times greater than a similar
attack against Pbkdf2."</p>
<p><em>&mdash; </em>Colin Percival<em> (author of the scrypt algorithm)</em></p>
</blockquote>
<p>This algorithm uses 4 parameters to generate a key of 32 bytes:</p>
<ul>
<li><code>salt</code>, a random string;</li>
<li><code>N</code>, the CPU cost;</li>
<li><code>r</code>, the memory cost;</li>
<li><code>p</code>, the parallelization cost.</li>
</ul>
<p>Following is a usage example for the <code>Scrypt</code> adapter:</p>
<pre class=codehilite><code class=language-php>use Laminas\Crypt\Key\Derivation\Scrypt;
use Laminas\Math\Rand;

$pass = 'password';
$salt = Rand::getBytes(32, true);
$key  = Scrypt::calc($pass, $salt, 2048, 2, 1, 32);

printf (&quot;Original password: %s\n&quot;, $pass);
printf (&quot;Derived key (hex): %s\n&quot;, bin2hex($key));</code></pre>
<blockquote>
<h3>Performance of the Scrypt Implementation</h3>
<p>The aim of the scrypt algorithm is to generate a secure derived key that
prevents brute force attacks.  Just like the other derivation functions, the
more time (and memory) spent executing the algorithm, the more secure the
derived key will be. Unfortunately a pure PHP implementation of the scrypt
algorithm is very slow compared with the C implementation (this is always
true, if you compare execution time of C with PHP). If you want use a faster
scrypt algorithm, we suggest installing the PECL <a href="http://pecl.php.net/package/scrypt">scrypt
extension</a>. The <code>Scrypt</code> adapter we
provide is able to recognize if the PECL extension is loaded and will use it
instead of the pure PHP implementation.</p>
</blockquote>
<h2 id="footnotes">Footnotes</h2>
<ul>
<li><sup>1</sup> See Colin Percival's <a href="http://www.tarsnap.com/scrypt/scrypt-slides.pdf">slides on scrypt from BSDCan'09</a>.</li>
</ul>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../hybrid/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../password/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>




    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/laminas/laminas-crypt/edit/master/docs/book/key-derivation.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            </div>
            <div class="col-md-3 col-sm-12 sidebar">
                
                    <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="..">laminas-crypt</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../intro/" class="subnavigation__link">Introduction</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Reference</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../block-cipher/" class="subnavigation__link">Block Ciphers</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../files/" class="subnavigation__link">Encrypting Files</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../hybrid/" class="subnavigation__link">Hybrid Cryptosystem</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Key Derivation</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../password/" class="subnavigation__link">Password</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../public-key/" class="subnavigation__link">Public Key Cryptography</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-10 offset-md-2">
                <h5>Laminas</h5>
                <ul>
                    <li>Laminas Project <a href="https://getlaminas.org/">The new foundation for the community-supported, open source continuation of Zend Framework</a></li>
                    <li>Laminas Components and MVC <a href="https://docs.laminas.dev/">Components and MVC for enterprise applications</a></li>
                    <li>Mezzio <a href="https://docs.mezzio.dev/">PSR-15 middleware in minutes</a></li>
                    <li>Laminas API Tools <a href="https://api-tools.getlaminas.org/">Build RESTful APIs in minutes</a></li>
                </ul>
            </div>
        </div>

        <div class="row">
            <div class="col-md-10 offset-md-2"> 
                <div class="row">

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Support</h4>
                        <ul class="support__list">
                            <li class="support__list-item">
                                <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://laminas.dev/chat" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://github.com/laminas" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://twitter.com/getlaminas" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/blog/feed-rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                            </li>
                        </ul>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">License</h4>
                        <p>
                            Code licensed under <a
                                href="https://github.com/laminas/laminas-crypt/blob/master/LICENSE.md">BSD 3-Clause</a>.
                        </p>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Copyright</h4>
                        <p>
                            <!--Built with love by the Laminas team with the help of our
                            <a href="https://github.com/laminas/laminas-crypt/graphs/contributors">contributors</a>.<br>-->
                            &copy; 2019-2020 by <a href="https://getlaminas.org/">The Laminas Project</a>.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script>
        let base_url = '..',
            project  = "components",
            siteName = 'laminas-crypt';
    </script>
    <script src="https://docs.laminas.dev/js/scripts.js"></script>
        <script src="../search/main.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in laminas-crypt" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>
</body>


</html>
